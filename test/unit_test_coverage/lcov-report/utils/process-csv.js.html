<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for utils/process-csv.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">utils/</a> process-csv.js
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">20% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>13/65</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>0/18</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">8.33% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>1/12</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">20% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>13/65</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">'use strict';
&nbsp;
//
// This data processing will eventually happen on the server.
// When we finish those scripts we will no longer need this file.
//
&nbsp;
var Papa = require( 'papaparse' );
var tileMapUtils = require( './tile-map' );
&nbsp;
// Convert the integers in the CSVs into human-readable dates.
function formatDate( index ) {
  var year = Math.floor( index / 12 ) + 2000;
  var month = index % 12;
&nbsp;
  var theDate = Date.UTC( year, month ) ;
&nbsp;
  return theDate;
}
&nbsp;
<span class="fstat-no" title="function not covered" >function processNumOriginationsData( csv, group ) {</span>
<span class="cstat-no" title="statement not covered" >  var data = {</span>
    unadjusted: [],
    adjusted: []
  };
<span class="cstat-no" title="statement not covered" >  csv = Papa.parse( csv ).data;</span>
<span class="cstat-no" title="statement not covered" >  csv.shift();</span>
<span class="cstat-no" title="statement not covered" >  csv.forEach( <span class="fstat-no" title="function not covered" >function( dataPoint ) {</span></span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    if ( formatDate( dataPoint[0] ) &gt; Date.UTC( 2008, 11 ) ) {</span>
<span class="cstat-no" title="statement not covered" >      var arr = [];</span>
<span class="cstat-no" title="statement not covered" >      var series = dataPoint[2];</span>
<span class="cstat-no" title="statement not covered" >      arr.push( formatDate( dataPoint[0] ) );</span>
<span class="cstat-no" title="statement not covered" >      arr.push( parseFloat( dataPoint[1] ) );</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >      if ( group ) {</span>
<span class="cstat-no" title="statement not covered" >        series = dataPoint[3];</span>
      }
&nbsp;
<span class="cstat-no" title="statement not covered" >      if ( !group || group === dataPoint[2] ) {</span>
<span class="cstat-no" title="statement not covered" >        if ( series === 'Unadjusted' ) {</span>
<span class="cstat-no" title="statement not covered" >          data.unadjusted.push( arr );</span>
        } else {
<span class="cstat-no" title="statement not covered" >          data.adjusted.push( arr );</span>
        }
      }
    }
&nbsp;
  } );
<span class="cstat-no" title="statement not covered" >  data.unadjusted = data.unadjusted.sort( <span class="fstat-no" title="function not covered" >function( a, b ) {</span></span>
<span class="cstat-no" title="statement not covered" >    return a[0] - b[0];</span>
  } );
<span class="cstat-no" title="statement not covered" >  data.adjusted = data.adjusted.sort( <span class="fstat-no" title="function not covered" >function( a, b ) {</span></span>
<span class="cstat-no" title="statement not covered" >    return a[0] - b[0];</span>
  } );
&nbsp;
<span class="cstat-no" title="statement not covered" >  data.projectedDate = {};</span>
<span class="cstat-no" title="statement not covered" >  data.projectedDate.timestamp = _getProjectedTimestamp( data.adjusted, false );</span>
<span class="cstat-no" title="statement not covered" >  data.projectedDate.label = _getProjectedDate( data.projectedDate.timestamp );</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  return data;</span>
}
&nbsp;
<span class="fstat-no" title="function not covered" >function processYoyData( csv, group ) {</span>
<span class="cstat-no" title="statement not covered" >  var data = {</span>
    values: [],
    projectedDate: null
  };
<span class="cstat-no" title="statement not covered" >  csv = Papa.parse( csv ).data;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  csv.forEach( <span class="fstat-no" title="function not covered" >function( dataPoint ) {</span></span>
<span class="cstat-no" title="statement not covered" >    if ( dataPoint[2] === group ) {</span>
<span class="cstat-no" title="statement not covered" >      var date = formatDate( dataPoint[0] );</span>
<span class="cstat-no" title="statement not covered" >      if ( date &gt; Date.UTC( 2008, 11 ) ) {</span>
<span class="cstat-no" title="statement not covered" >        data.values.push( [ formatDate( dataPoint[0] ), Number( dataPoint[1] ) * 100 ] );</span>
      }
    }
  } );
&nbsp;
<span class="cstat-no" title="statement not covered" >  data.projectedDate = {};</span>
<span class="cstat-no" title="statement not covered" >  data.projectedDate.timestamp = _getProjectedTimestamp( data.values, true );</span>
<span class="cstat-no" title="statement not covered" >  data.projectedDate.label = _getProjectedDate( data.projectedDate.timestamp );</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  return data;</span>
}
&nbsp;
/**
 * Returns a UTC timestamp number for the month when each graph's data is projected
 *
 * @param {Array} valuesList - list of values from the data, containing an array with timestamp representing the month and year at index 0, and the value at index 1
 * @param {Boolean} isYoy - is the valuesList year-over-year (Yoy) data? If so, it includes an additional month, so we need to calculate the projected date differently.
 * @returns {String} a timestamp.
 */
<span class="fstat-no" title="function not covered" >function _getProjectedTimestamp( valuesList, isYoy ) {</span>
<span class="cstat-no" title="statement not covered" >  var mostRecentMonthOfDataAvailable = valuesList[valuesList.length - 1][0];</span>
&nbsp;
  /*
  152.083 days = 5 months, which is six months ago for line chart data. Wee count 5 months back, because the timestamps are the first of each month:
  0 - november 1
  1 month - october 1
  2 - sept 1
  3 - aug 1
  4 - jul 1
  5 - june 1
  For data through November, months AFTER May are projected. June through November should be projected in the UI.
  */
<span class="cstat-no" title="statement not covered" >  var projectedThreshold = 60 * 60 * 24 * 152.083 * 1000;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  if ( isYoy === true ) {</span>
    // Year over year data has an extra month compared to line chart data, so we include the last 7 months of the set instead of only 6.
<span class="cstat-no" title="statement not covered" >    projectedThreshold = 60 * 60 * 24 * 365 * 1000 / 2;</span>
  }
&nbsp;
<span class="cstat-no" title="statement not covered" >  return mostRecentMonthOfDataAvailable - projectedThreshold;</span>
}
&nbsp;
/**
 * Returns a human-readable string representing the month and year after which data in each graph is projected
 *
 * @param {Number} timestamp - UTC timestamp representing the milliseconds elapsed since the UNIX epoch, for the month when each graph begins displaying projected data
 * @returns {String} projectedDate - text with the Month and Year of the projected data cutoff point, for use in labeling projected date in graphs
 */
<span class="fstat-no" title="function not covered" >function _getProjectedDate( timestamp ) {</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  var months = [ 'January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December' ];</span>
&nbsp;
  // Projected month threshhold is one month before the data itself is projected. E.g., data after May 2016 is projected, so graphs show June 2016 and after as projected, not inclusive of the month of May.
<span class="cstat-no" title="statement not covered" >  var projectedMonth = months[new Date( timestamp ).getMonth() - 1];</span>
<span class="cstat-no" title="statement not covered" >  var projectedYear = new Date( timestamp ).getFullYear();</span>
<span class="cstat-no" title="statement not covered" >  var projectedDate = projectedMonth + ' ' + projectedYear;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  return projectedDate;</span>
}
&nbsp;
<span class="fstat-no" title="function not covered" >function processMapData( csv ) {</span>
<span class="cstat-no" title="statement not covered" >  var data = Papa.parse( csv ).data;</span>
  // Delete the first row (column titles)
<span class="cstat-no" title="statement not covered" >  data.shift();</span>
  // Filter out any empty values just in case
<span class="cstat-no" title="statement not covered" >  data = data.filter( <span class="fstat-no" title="function not covered" >function( row ) {</span></span>
<span class="cstat-no" title="statement not covered" >    return Boolean( row[0] );</span>
  } );
<span class="cstat-no" title="statement not covered" >  data = data.map( <span class="fstat-no" title="function not covered" >function( row, i ) {</span></span>
<span class="cstat-no" title="statement not covered" >    var state = tileMapUtils.statePaths['state' + row[0]],</span>
        value = Math.round( row[1] * 100 ),
        tooltip = state.abbr + ' ' + ( value &lt; 0 ? 'decreased' : 'increased' ) + ' by ' + Math.abs( value ) + '%';
<span class="cstat-no" title="statement not covered" >    return {</span>
      name: state.abbr,
      path: state.path,
      value: value,
      tooltip: tooltip,
      color: tileMapUtils.getColor( value )
    };
  } );
<span class="cstat-no" title="statement not covered" >  return data;</span>
}
&nbsp;
module.exports = {
  formatDate: formatDate,
  originations: processNumOriginationsData,
  yoy: processYoyData,
  map: processMapData
};
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Wed Feb 08 2017 20:18:43 GMT-0500 (EST)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
