@import (less) '../../node_modules/highcharts/css/highcharts.css';

// cf-core is included for cf-brand-colors and media queries.
@import (less) 'cf-core.less';

/* Chart colors
   TODO: Investigate using highcharts API to set chart colors. */
@chart-blue-primary: @pacific;
@chart-blue-secondary: @pacific-60;
@chart-gold-primary: @dark-gold;
@chart-gold-secondary: @gold-80;
@chart-green-primary: @green;
@chart-green-secondary: @green-60;
@chart-navy-primary: @navy;
@chart-navy-secondary: @navy-60;
@chart-neutral-primary: @neutral;
@chart-neutral-secondary: @neutral-60;
@chart-purple-primary: @purple;
@chart-purple-secondary: @purple-60;
@chart-teal-primary: @teal;
@chart-teal-secondary: @teal-60;

/*
Updating the charts:
Set the positioning of the chart UI elements using the JavaScript API,
then add in styles below that aren't possible through the API.
 */

.u-chart-label {
  font-size: @base-font-size-px;
  font-family: inherit;
  color: @gray;
  //fill: @gray;
}

.u-chart-colorizer-line( @color-primary ) {
  .highcharts-color-0,
  .highcharts-color-1,
  .highcharts-navigator-series .highcharts-graph  {
    stroke: @color-primary;
  }

  .highcharts-tooltip {
    margin-left: 3px;
    .u-chart-label();
    .highcharts-header {
      .u-chart-label();
      margin-left: -5px;
    }

    .highcharts-strong {
      font-weight: normal;
    }

    .highcharts-color-0,
    .highcharts-color-1 {
      position: relative;

      /* We want a dash next to each series label in tooltip as a key.
         By default, highcharts adds a bullet next to the series label.
         This hack moves that bullet far off screen, we then offset the
         dash back the other direction with a 4px adjustment to position it.
      */
      left: -9999px;

      &::before {
        position: absolute;
        // This value offsets the value sent in the parent position.
        left: 9995px;

        content: '';
        padding-top: 3px;
        width: 15px;
        margin-top: 8px;
        /* Using an SVG prevents an issue where the 1px dash line will disappear
           at certain heights due to rounding off of single pixels.
        */
        @svg-url: %( "data:image/svg+xml;charset=utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' version='1.1' width='14' height='4' viewBox='0 0 14 4'%3E%3Cpath d='M 0.5 0.5 L 261.5 0.5 261.5 79.5 0.5 79.5 Z' style='fill: %a'%3E%3C/path%3E%3C/svg%3E", escape( @color-primary ) );
        background-image: url( "@{svg-url}" );
        background-repeat: no-repeat;
      }
    }

    .highcharts-color-1 {
      &::before {
        padding-top: 1.5px;
      }
    }
  }

  /*.highcharts-tooltip-box {
    .highcharts-color-0,
    .highcharts-color-1 {
      list-style:none;
      display: inline-block;
      height: 4px;
      width: 15px;
      margin-bottom: 3px;
      box-shadow: 15px 4px inset @color-primary;
      //background: @color-primary;
    }
    .highcharts-color-1 {
      height: 1px;
      margin-bottom: 5px;
    }
  }*/
}

.u-chart-colorizer-bar( @color-primary, @color-secondary ) {
  .highcharts-point {
    fill: @color-secondary;

    &.highcharts-data__unprojected {
      fill: @color-primary;
    }
  }

  .highcharts-tooltip-box {
    stroke: @color-primary;
  }
}

.u-chart-colorizer-navigator( @color-primary, @color-secondary ) {
  .highcharts-navigator-series .highcharts-graph  {
    stroke: @color-primary;
  }

  .highcharts-navigator-series .highcharts-graph.highcharts-zone-graph-1  {
    stroke: @color-secondary;
  }
}

.cfpb-chart {
  position: relative;
  max-width: 650px;
  min-width: 320px;
  height: 500px;
  margin-bottom: 25px;

  // Create a horizontal rule.
  &:after {
    content: '';
    display: block;
    position: absolute;
    top: 80px;
    width: 100%;
    height: 0;
    border-top: 2px solid @gray-10;

    .respond-to-min( 600px, {
      top: 75px;
    } );

    .respond-to-min( 655px, {
      top: 80px;
    } );
  }

  /* Set the layering of the chart relative to the components that have
     `useHTML: true` set in the JavaScript. We need to bring the SVG chart
     in front of everything else, and then hide the background fill so the
     HTML labels show through, and then move the tooltip labels to the top.
   */
  .highcharts-root {
    position: relative;
    z-index: 2000;
  }

  .highcharts-background {
    opacity: 0;
  }

  .highcharts-tooltip {
    z-index: 3000;
  }

  .highcharts-root,
  .highcharts-container,
  .highcharts-legend-box,
  .highcharts-axis-labels,
  .highcharts-tooltip text {
    .u-chart-label();
  }

  &[data-chart-type="line"] {

    // Center "Select time range" label.
    .highcharts-range-selector-label {

      .respond-to-max( 800px, {
          .h6();
          left: calc( 50% - 64px ) !important;
      } );
    }

    .highcharts-axis-title {
      /* The y-axis title will be positioned to the left edge of the
         y-axis label width. This overrides that auto-layout so that
         independent of the y-axis label width the title will always
         be the same distance from the left-hand edge of the chart,
         which aligns it with the legend in the upper-left.
      */
      left: 0 !important;
      min-width: 300px;
    }

    // The "Values after â€¦ are projected" label.
    .highcharts-plot-line-label {
      white-space: normal !important;
      left: 50% !important;
      width: 50% !important;
    }

    /*********
     * LEGEND
     *********/

     // The vertical gap between the two legend items. Set on the label and line.
     @chart-legend-vert-gap: 10px;

     // "Seasonally adjusted" and "Unadjusted" labels.
     div.highcharts-legend {

       // "Seasonally adjusted" label.
       .highcharts-color-0 span {
         white-space: normal !important;
       }

       // "Unadjusted" label.
       .highcharts-color-1 span {
         transform: translateY( @chart-legend-vert-gap );
       }
     }

     // SVG legend lines.
     .highcharts-root {

       .highcharts-legend {
         // Seasonally adjusted legend line.
         .highcharts-legend-item.highcharts-color-0 .highcharts-graph {
           stroke-width: 3px;
         }

         // Unadjusted legend line.
         .highcharts-legend-item.highcharts-color-1 .highcharts-graph {
           transform: translateY( @chart-legend-vert-gap );
           stroke-width: 1px;
         }
       }

       .highcharts-tracker,
       .highcharts-graph {
         stroke-linejoin: miter;
         stroke-linecap: butt;
       }

     }

     /*****************
      * RANGE SELECTOR
      ****************/
    .highcharts-button {

      & text {
        /*
        This vertically aligns the button text, but in IE11 the y value will
        not be overridden. https://github.com/highcharts/highcharts/issues/1285
        */
        transform: translateY( 13px );
      }
      fill: @pacific-20;
      font-size: @size-v;

      &:hover {
        cursor: pointer;
        .highcharts-button-box {
          fill: @pacific-60;
        }
      }
    }

    .highcharts-button-pressed,
    .highcharts-button-hover {
      fill: @pacific-60;
      font-weight: 600;
    }

    // Seasonally adjusted
    .highcharts-series-0 {
      .highcharts-graph {
        stroke-width: 3px;
      }
    }

    // Unadjusted
    .highcharts-series-1 {
      .highcharts-graph {
        stroke-width: 1px;
      }
    }

    // Projected data for last six months.
    .highcharts-zone-graph-1 {
      stroke-dasharray: 5, 5;
    }

    .highcharts-color-1 .highcharts-zone-graph-1 {
      stroke-dasharray: 3, 3;
    }

    &[data-chart-color='blue'] {
      .u-chart-colorizer-line( @chart-blue-primary );
    }

    &[data-chart-color='gold'] {
      .u-chart-colorizer-line( @chart-gold-primary );
    }

    &[data-chart-color='green'] {
      .u-chart-colorizer-line( @chart-green-primary );
    }

    &[data-chart-color='neutral'] {
      .u-chart-colorizer-line( @chart-neutral-primary );
    }

    &[data-chart-color='purple'] {
      .u-chart-colorizer-line( @chart-purple-primary );
    }

    &[data-chart-color='teal'] {
      .u-chart-colorizer-line( @chart-teal-primary );
    }

    &[data-chart-color='navy'] {
      .u-chart-colorizer-line( @chart-navy-primary );
    }

    /* Using navigator { enabled: false } also disables the pressed state of the
       range selector buttons, so instead we hide the navigator at small sizes. */
    .highcharts-navigator,
    .highcharts-navigator-series,
    .highcharts-navigator-xaxis,
    .highcharts-navigator-yaxis,
    .highcharts-scrollbar {
      display: none;
      visibility: hidden;

      .respond-to-min( 800px, {
        display: block;
        visibility: visible;
      } );
    }

    .highcharts-xaxis-labels {
      text-align: center;
    }

  }

  &[data-chart-type='bar'] {

    &[data-chart-color='blue'] {
      .u-chart-colorizer-bar( @chart-blue-primary, @chart-blue-secondary );
      .u-chart-colorizer-navigator( @chart-blue-primary, @chart-blue-secondary );
    }

    &[data-chart-color='green'] {
      .u-chart-colorizer-bar( @chart-green-primary, @chart-green-secondary );
      .u-chart-colorizer-navigator( @chart-green-primary, @chart-green-secondary );
    }

    &[data-chart-color='teal'] {
      .u-chart-colorizer-bar( @chart-teal-primary, @chart-teal-secondary );
      .u-chart-colorizer-navigator( @chart-teal-primary, @chart-teal-secondary );
    }

    &[data-chart-color='navy'] {
      .u-chart-colorizer-bar( @chart-navy-primary, @chart-navy-secondary );
      .u-chart-colorizer-navigator( @chart-navy-primary, @chart-navy-secondary );
    }
  }

  &[data-chart-color='blue'] {
    .u-chart-colorizer-navigator( @chart-blue-primary, @chart-blue-secondary );
  }

  &[data-chart-color='green'] {
    .u-chart-colorizer-navigator( @chart-green-primary, @chart-green-secondary );
  }

  &[data-chart-color='teal'] {
    .u-chart-colorizer-navigator( @chart-teal-primary, @chart-teal-secondary );
  }

  &[data-chart-color='navy'] {
    .u-chart-colorizer-navigator( @chart-navy-primary, @chart-navy-secondary );
  }
}
